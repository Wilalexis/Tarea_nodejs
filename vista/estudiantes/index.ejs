<!DOCTYPE html>
<html lang="en">
<head>
  <title>Estudiantes</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="estudiantes/drug.png">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>

<nav class="navbar navbar-expand-sm bg-success navbar-light">
  <!-- Brand/logo -->
  <a class="navbar-brand" href="#">
    <img src="estudiantes/vacunacion.png" style="width:40px;">
  </a>
  
  <!-- Links -->
  <ul class="navbar-nav">
    <li class="nav-item">
      <a class="nav-link" href="#">Estudiantes</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#">Tipos de sangre</a>
    </li>
  </ul>
</nav>

<div class="container">
  
  <br><br>
  <h2>Tabla de estudiantes</h2>
  <br>
  
  <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal" onclick="borrar()">
    Ingresar
  </button>

    
  <!-- Modal de modificar/eliminar -->
  <div class="modal" id="algo">
    <div class="modal-dialog">
      <div class="modal-content">
      
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">Modificar/eliminar estudiante</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        
        <!-- Modal body -->
        <div class="modal-body">
          <form action="/crud_c" method="post" id="formulario">
            <input type="text" name="id_estudiante" id="id_estudiante" class="form-control" value="0" readonly>
            <div class="form-group">
              <label for="carne">Carnet</label>
              <input type="text" class="form-control" id="carne" placeholder="Ingrese carnet" name="carne">
            </div>
            <div class="form-group">
              <label for="nombres">Nombres</label>
              <input type="text" class="form-control" id="nombres" placeholder="Ingrese los nombres" name="nombres">
            </div>
            <div class="form-group">
              <label for="apellidos">Apellidos</label>
              <input type="text" class="form-control" id="apellidos" placeholder="Ingrese los apellidos" name="apellidos">
            </div>
            <div class="form-group">
              <label for="direccion">Direccio:</label>
              <input type="text" class="form-control" id="direccion" placeholder="Ingrese la direccion" name="direccion">
            </div>
            <div class="form-group">
              <label for="telefono">Telefono</label>
              <input type="number" class="form-control" id="telefono" placeholder="Ingrese numero de telefono" name="telefono">
            </div>
            <div class="form-group">
              <label for="correo_electronico">Correo electronico:</label>
              <input type="text" class="form-control" id="correo_electronico" placeholder="Ingrese correo electronico" name="correo_electronico">
            </div>
            <div class="form-group">
              <label for="id_tipo_sangre">Tipo de sangre</label>
              <input type="text" class="form-control" id="id_tipo_sangre" placeholder="Ingrese el tipo de sangre" name="id_tipo_sangre">
            </div>
            <div class="form-group">
              <label for="fecha_nacimiento">Fecha de nacimiento</label>
              <input type="date" class="form-control" id="fecha_nacimiento"  name="fecha_nacimiento">
            </div>
            <!-- Modal footer -->
        <div class="modal-footer">
          <button type="submit" class="btn btn-success" name="btn_modificar" id="btn_modificar" value="modificar">Modificar</button>
          <button type="submit" class="btn btn-danger" name="btn_eliminar" id="btn_eliminar" value="eliminar" onclick="javascript:if(!confirm('Â¿Desea Eliminar?'))return false">Eliminar</button>
        </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de ingresar -->
  <div class="modal" id="myModal">
    <div class="modal-dialog">
      <div class="modal-content">
      
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">Ingrese los datos de un nuevo estudiante</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        
        <div class="modal-body">
          <form action="/crud_c" method="post" id="formulario">
            <div class="form-group">
              <label for="carne">Carnet</label>
              <input type="text" class="form-control" id="carne" placeholder="Ingrese carnet" name="carne">
            </div>
            <div class="form-group">
              <label for="nombres">Nombres</label>
              <input type="text" class="form-control" id="nombres" placeholder="Ingrese los nombres" name="nombres">
            </div>
            <div class="form-group">
              <label for="apellidos">Apellidos</label>
              <input type="text" class="form-control" id="apellidos" placeholder="Ingrese los apellidos" name="apellidos">
            </div>
            <div class="form-group">
              <label for="direccion">Direccio:</label>
              <input type="text" class="form-control" id="direccion" placeholder="Ingrese la direccion" name="direccion">
            </div>
            <div class="form-group">
              <label for="telefono">Telefono</label>
              <input type="number" class="form-control" id="telefono" placeholder="Ingrese numero de telefono" name="telefono">
            </div>
            <div class="form-group">
              <label for="correo_electronico">Correo electronico:</label>
              <input type="text" class="form-control" id="correo_electronico" placeholder="Ingrese correo electronico" name="correo_electronico">
            </div>
            <div class="form-group">
              <label for="id_tipo_sangre">Tipo de sangre.</label>
              <input type="text" class="form-control" id="id_tipo_sangre" placeholder="Ingrese el tipo de sangre" name="id_tipo_sangre">
            </div>
            <div class="form-group">
              <label for="fecha_nacimiento">Fecha de nacimiento</label>
              <input type="date" class="form-control" id="fecha_nacimiento"  name="fecha_nacimiento">
            </div>
            <!-- Modal footer -->
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary" name="btn_crear" id="btn_crear" value="crear">Crear</button>
        </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <br><br>
  <table class="table table-striped table-bordered">
    <thead class="thead-dark">
      <tr>
        <th></th>
        <th>Carnet</th>
        <th>Nombres</th>
        <th>Apellidos</th>
        <th>Direccion</th>
        <th>Telefono</th>
        <th>Correo electronico</th>
        <th>Tipo sangre</th>
        <th>fecha de nacimiento</th>
      </tr>
    </thead>
    <tbody id="tbl_estudiantes">
      <% resultado.forEach((estudiante)=>{ %>
      <tr>
        <td><%= estudiante.id_estudiante %></td>
        <td><%= estudiante.carne %></td>
        <td><%= estudiante.nombres %></td>
        <td><%= estudiante.apellidos %></td>
        <td><%= estudiante.direccion %></td>
        <td><%= estudiante.telefono %></td>
        <td><%= estudiante.correo_electronico %></td>
        <td><%= estudiante.id_tipo_sangre %></td>
        <td><%= estudiante.fecha_nacimiento %></td>
      </tr>
      <% }); %>
    </tbody>
  </table>
</div>

<script>
  //Para validar la expresion regular
  const formulario = document.getElementById('formulario')
  const inputs = document.querySelectorAll('#formulario input')

  const expresion={
      carne: /^[E]+[0-9]{3}$/   //Expresion regular
  }

  const validar = (e) =>{
      switch(e.target.name){
          case "carne":
              if(expresion.carne.test(e.target.value)){
                      return true
              }else{
                  
                  confirm("Formato valido: E001 al E999")
                  return false                
                  
              }
          break
      }
  }

  inputs.forEach((input) =>{
      input.addEventListener('blur', validar)
  })
  formulario.addEventListener('submit',(e) =>{

  })

  //Para mostrar el contenido de los inputs
  $('#tbl_estudiantes').on('click','tr td',function(evt){
    var target,id_estudiante,id_tipo_sangre,carne,nombres,apellidos,direccion,telefono,correo_electronico,fecha_nacimiento
    target = $(event.target)
    id_estudiante = target.parents("tr").find("td").eq(0).html()
    carne = target.parents("tr").find("td").eq(1).html()
    nombres = target.parents("tr").find("td").eq(2).html()
    apellidos = target.parents("tr").find("td").eq(3).html()
    direccion = target.parents("tr").find("td").eq(4).html()
    telefono = target.parents("tr").find("td").eq(5).html()
    correo_electronico = target.parents("tr").find("td").eq(6).html()
    id_tipo_sangre = target.parents("tr").find("td").eq(7).html()
    fecha_nacimiento = target.parents("tr").find("td").eq(8).html()

    $("#id_estudiante").val(id_estudiante)
    $("#carne").val(carne)
    $("#nombres").val(nombres)
    $("#apellidos").val(apellidos)
    $("#direccion").val(direccion)
    $("#telefono").val(telefono)
    $("#correo_electronico").val(correo_electronico)
    $("#id_tipo_sangre").val(id_tipo_sangre)
    $("#fecha_nacimiento").val(fecha_nacimiento)

    $("#algo").modal('show');
  })
</script>

</body>
</html>

